{% extends "museum_site/base.html" %}

{% load crispy_forms_tags %}

{% block content %}
    {% load static %}

    {% if too_many_selected %}
        <div class='alert alert-warning alert-dismissible fade show' role='alert'>
            <strong>Too many artworks selected!</strong> You should deselect some artworks, the 
            maximum number you can select is 10.
            <button type='button' class='close' data-dismiss='alert' aria-label='Close'>
                <span aria-hidden='true'>&times;</span>
            </button>
        </div>
    {% endif %}

    <div class='row artwork-body'>
        <div class='col' style="margin-left: 0.25em;">
            <img src="{% static 'img/images/' %}{{ artwork.img_file }}" alt="{{ artwork.title }}"
                 class="img-fluid"/>
        </div>

        <div class='col' style="margin-right: 0.25em;">
            <span class="text-title">{{ artwork.title }}</span>

            <hr class="full-separator"/>

            {% if artists %}
                <div><strong>Artists:</strong></div>
                    <ul class="list">
                        {% for e in artists %}
                            <li>{{ e }}</li>
                        {% endfor %}
                    </ul>
                <div>
            {% else %}
                {% if artwork.artist %}
                <div>
                    <strong>Artist:</strong>
                    {% for idx, name in artwork.artist %}
                        {% if idx > 0 %}
                            <span>, </span>
                        {% endif %}
                        <span>{{ name }}</span>
                    {% endfor %}
                </div>
                {% endif %}

                {% if artwork.birth_date %}
                <div>
                    <strong>Born:</strong>
                    {% for idx, date in artwork.birth_date %}
                        {% if idx > 0 %}
                        <span>, </span>
                        {% endif %}
                        <span>{{ date }}</span>
                    {% endfor %}
                </div>
                {% endif %}

                {% if artwork.death_date %}
                <div><strong>Died:</strong>
                    {% for idx, date in artwork.death_date %}
                        {% if idx > 0 %}
                            <span>, </span>
                        {% endif %}
                        <span>{{ date }}</span>
                    {% endfor %}
                </div>
                {% endif %}
            {% endif %}

            {% if artwork.earliest_date and artwork.latest_date %}
                {% if artwork.earliest_date == artwork.latest_date %}
                    <div><strong>Year active:</strong> {{ artwork.earliest_date }}</div>
                {%  else %}
                    <div>
                        <strong>Years active:</strong> {{ artwork.earliest_date }} &ndash; {{ artwork.latest_date }}
                    </div>
                {% endif %}
            {% endif %}

            <hr class="full-separator"/>

            {% if artwork.execution_date %}
                <div><strong>Execution Date:</strong> {{ artwork.execution_date }}</div>
            {% endif %}

            {% if artwork.classification %}
                <div><strong>Classification:</strong> {{ artwork.classification }}</div>
            {% endif %}

            {% if artwork.collection %}
                <div><strong>Collection:</strong> {{ artwork.collection }}</div>
            {% endif %}

            {% comment %}Show the button "Show More" and details only if this content exists{% endcomment %}
            {% if artwork.linked_topics or artwork.linked_terms or artwork.medium %}
                <div class='expandable-content'>
                    <div id='more-content' class='collapse in' aria-expanded='false'>
                        {% if artwork.linked_topics %}
                            <div><strong>Topics:</strong></div>
                            <ul class="list">
                                {% for topic in artwork.linked_topics %}
                                    <li>{{ topic }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}

                        {% if artwork.linked_terms %}
                            <div><strong>Terms:</strong></div>
                            <ul class="list">
                                {% for term in artwork.linked_terms %}
                                    <li>{{ term }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}

                        {% if artwork.medium %}
                            <div><strong>Medium:</strong></div>
                            <ul class="list">
                                {% for medium in artwork.medium %}
                                    <li>{{ medium }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                    <br />
                    <a role="button" class="collapsed" id='show-more-button'
                       data-toggle="collapse" aria-expanded="false" aria-controls="more-content"
                       href="#more-content"
                       onclick="return interaction_event(
                               'show-more',
                               '{{ artwork.art_id }}',
                               '{{ page_id }}',
                               '{{ csrf_token }}'
                               );"></a>
                </div>
            {% endif %}
            
            {% if study_context == 'user' %}
                <br />

                <form action = '/selected/' method = 'post'>
                    {% csrf_token %}
                    {% if too_many_selected or artwork.art_id in already_selected %}
                        <input type='submit' class='btn btn-success' value='Select' name='selection_button' disabled>
                    {% else %}
                        <input type='submit' class='btn btn-success' value='Select' name='selection_button'>
                    {% endif %}
                    {% if artwork.art_id in already_selected or selection_count == 0 or too_many_selected %}    
                        <input type='submit' class='btn btn-danger' value='Deselect' name='selection_button'>
                    {% else %}
                        <input type='submit' class='btn btn-danger' value='Deselect' name='selection_button' disabled>
                    {% endif %}
                    <input type='hidden' value="{{ artwork.art_id }}" name='artwork_id'>
                </form>
            {% endif %}
            
            
            {% if study_context == 'focus' %}
                <hr class="full-separator"/>

                <h5>Rate me:</h5>
                <div class="rating">
                    {% with rating_list='5 4 3 2 1' %}
                        {% for rating_value in rating_list.split %}
                            <input
                                    type="radio" name="rating" id="{{ rating_value }}" value="{{ rating_value }}"
                                    onclick="return rating_event(
                                            '{{ artwork.art_id }}',
                                            '{{ rating_value }}',
                                            '{{ csrf_token }}'
                                            );">
                            <label for='{{ rating_value }}'>â˜†</label>
                        {% endfor %}
                    {% endwith %}
                </div>
            {% endif %}

            {% if study_context == 'focus' %}
                <hr class="full-separator"/>

                <h5>Similar artworks:</h5>
                <div class = 'row'>
                    {% for art in similar_artworks %}
                        <div class = 'col-sm-2'>
                            {% comment %} <div class = 'card' id = 'similar-art-card' style = "background-color: white;"> {% endcomment %}
                                <a href = "{% url 'museum_site:artwork' art.similar_art.art_id %}">
                                    <img class = 'card-img-top' 
                                        src = "{% static 'img/images/' %}{{ art.similar_art.img_file }}" alt = '{{ art.simiar_art.title|cut:"" }}' />
                                </a>
                            {% comment %} </div> {% endcomment %}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}

        </div>
    </div>

    {% comment %}
        {% if artwork_rating %}
            <script type="text/javascript">
                $(function () {
                    var $radios = $('input:radio[name=rating]');
                    $radios.filter("[value='{{ artwork_rating }}'").prop('checked', True)
                });
            </script>
        {% endif %}
    {% endcomment %}
    </div>
{% endblock content %}
